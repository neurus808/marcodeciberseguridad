const n=document.getElementById("canvas"),e=n.getContext("2d"),y=document.getElementById("upload"),I=document.getElementById("tool"),w=document.getElementById("watermark"),m=document.getElementById("iaEffect");let s=null,r=!1;y.addEventListener("change",a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];if(t){const l=new FileReader;l.onload=i=>{s=new Image,s.onload=()=>{n.width=s.width,n.height=s.height,g()},s.src=i.target.result},l.readAsDataURL(t)}});function g(){s&&(e.clearRect(0,0,n.width,n.height),e.drawImage(s,0,0),p(w.value),m.value!=="none"&&L(m.value))}function v(a){const t=n.getBoundingClientRect(),o=(a.touches?a.touches[0].clientX:a.clientX)-t.left,l=(a.touches?a.touches[0].clientY:a.clientY)-t.top;return{x:o*n.width/t.width,y:l*n.height/t.height}}function E(a,t){const l=I.value;if(l==="draw")e.fillStyle="black",e.beginPath(),e.arc(a,t,12,0,2*Math.PI),e.fill();else if(l==="pixel"){const i=e.getImageData(a,t,12,12);let c=0,h=0,f=0;const u=i.data.length/4;for(let d=0;d<i.data.length;d+=4)c+=i.data[d],h+=i.data[d+1],f+=i.data[d+2];c/=u,h/=u,f/=u;for(let d=0;d<i.data.length;d+=4)i.data[d]=c,i.data[d+1]=h,i.data[d+2]=f;e.putImageData(i,a,t)}}n.addEventListener("mousedown",()=>r=!0);n.addEventListener("mouseup",()=>r=!1);n.addEventListener("mouseleave",()=>r=!1);n.addEventListener("mousemove",a=>{if(!r||!s)return;const{x:t,y:o}=v(a);E(t,o)});n.addEventListener("touchstart",()=>r=!0);n.addEventListener("touchend",()=>r=!1);n.addEventListener("touchcancel",()=>r=!1);n.addEventListener("touchmove",a=>{if(!r||!s)return;const{x:t,y:o}=v(a);E(t,o)},{passive:!1});w.addEventListener("input",()=>{s&&g()});function p(a){if(!(!a||!n.width||!n.height)){e.save(),e.font="20px Arial",e.fillStyle="rgba(0, 0, 0, 0.15)",e.rotate(-.2);for(let t=100;t<n.height;t+=180)for(let o=0;o<n.width;o+=300)e.fillText(a,o,t);e.restore()}}function L(a){if(e.save(),e.strokeStyle="rgba(0,0,0,0.08)",e.lineWidth=1,a==="waves")for(let t=0;t<n.height;t+=20){e.beginPath();for(let o=0;o<n.width;o++)e.lineTo(o,t+5*Math.sin(o*.05));e.stroke()}else if(a==="lines")for(let t=0;t<50;t++){const o=t*10;e.beginPath(),e.moveTo(0,o),e.lineTo(n.width,o+(t%2===0?15:-15)),e.stroke()}else if(a==="distort")for(let t=0;t<300;t++){const o=Math.random()*n.width,l=Math.random()*n.height;e.beginPath(),e.arc(o,l,5,0,Math.PI*2),e.stroke()}e.restore()}function k(){s&&g()}window.resetCanvas=k;function x(){const a=document.createElement("a");a.download="ci-protegida.png",a.href=n.toDataURL(),a.click()}window.download=x;
